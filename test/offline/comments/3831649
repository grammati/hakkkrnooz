<html><head><link rel="stylesheet" type="text/css" href="http://ycombinator.com/news.css">
<link rel="shortcut icon" href="http://ycombinator.com/favicon.ico">
<script>
function byId(id) {
  return document.getElementById(id);
}

function vote(node) {
  var v = node.id.split(/_/);   // {'up', '123'}
  var item = v[1]; 

  // hide arrows
  byId('up_'   + item).style.visibility = 'hidden';
  byId('down_' + item).style.visibility = 'hidden';

  // ping server
  var ping = new Image();
  ping.src = node.href;

  return false; // cancel browser nav
} </script><title>Designing a DCPU-16 emulator in Haskell: on determinism and I/O | Hacker News</title></head><body><center><table border=0 cellpadding=0 cellspacing=0 width="85%" bgcolor=#f6f6ef><tr><td bgcolor=#ff6600><table border=0 cellpadding=0 cellspacing=0 width="100%" style="padding:2px"><tr><td style="width:18px;padding-right:4px"><a href="http://ycombinator.com"><img src="http://ycombinator.com/images/y18.gif" width=18 height=18 style="border:1px #ffffff solid;"></img></a></td><td style="line-height:12pt; height:10px;"><span class="pagetop"><b><a href="news">Hacker News</a></b><img src="http://ycombinator.com/images/s.gif" height=1 width=10><a href="newest">new</a> | <a href="newcomments">comments</a> | <a href="ask">ask</a> | <a href="jobs">jobs</a> | <a href="submit">submit</a></span></td><td style="text-align:right;padding-right:4px;"><span class="pagetop"><a href="newslogin?whence=%69%74%65%6d%3f%69%64%3d%33%38%33%31%36%34%39">login</a></span></td></tr></table></td></tr><tr style="height:10px"></tr><tr><td><table border=0><tr><td><center><a id=up_3831649 href="vote?for=3831649&dir=up&whence=%69%74%65%6d%3f%69%64%3d%33%38%33%31%36%34%39"><img src="http://ycombinator.com/images/grayarrow.gif" border=0 vspace=3 hspace=2></a><span id=down_3831649></span></center></td><td class="title"><a href="http://jaspervdj.be/posts/2012-04-12-st-io-dcpu-16.html">Designing a DCPU-16 emulator in Haskell: on determinism and I/O</a><span class="comhead"> (jaspervdj.be) </span></td></tr><tr><td colspan=1></td><td class="subtext"><span id=score_3831649>16 points</span> by <a href="user?id=jaspervdj">jaspervdj</a> 1 hour ago  | <a href="item?id=3831649">3 comments</a></td></tr><tr style="height:10px"></tr><tr><td></td><td><form method=post action="/r"><input type=hidden name="fnid" value="p0RbFDtIXJ"><textarea name="text" rows=6 cols=60></textarea><br><br>
<input type=submit value="add comment"></form></td></tr></table><br><br>
<table border=0><tr><td><table border=0><tr><td><img src="http://ycombinator.com/images/s.gif" height=1 width=0></td><td valign=top><center><a id=up_3831723 href="vote?for=3831723&dir=up&whence=%69%74%65%6d%3f%69%64%3d%33%38%33%31%36%34%39"><img src="http://ycombinator.com/images/grayarrow.gif" border=0 vspace=3 hspace=2></a><span id=down_3831723></span></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px; "><span class="comhead"><a href="user?id=CJefferson">CJefferson</a> 38 minutes ago  | <a href="item?id=3831723">link</a></span></div><br>
<span class="comment"><font color=#000000>I suspect this is why I don't "understand" Haskell programmers (I do understand a reasonable amount of Haskell).<p>To me, it looks like you haven't "done" anything at all. You haven't emulated a single instruction. This part of the emulator in C++ would be a couple of structs and helper functions thrown at the top of the file.<p>As far as I can see, you've just written a bunch of very complicated code and monads, to get you to place would would have started at in a non-functional language. In that case, what exactly have you gained by using Haskell at all?<p>P.S. Sorry if this comment comes across as insulting / argumentative. I do not have the time to write it in a more pleasing way.</font></span><p><font size=1><u><a href="reply?id=3831723&whence=%69%74%65%6d%3f%69%64%3d%33%38%33%31%36%34%39">reply</a></u></font></td></tr></table></td></tr><tr><td><table border=0><tr><td><img src="http://ycombinator.com/images/s.gif" height=1 width=40></td><td valign=top><center><a id=up_3831732 href="vote?for=3831732&dir=up&whence=%69%74%65%6d%3f%69%64%3d%33%38%33%31%36%34%39"><img src="http://ycombinator.com/images/grayarrow.gif" border=0 vspace=3 hspace=2></a><span id=down_3831732></span></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px; "><span class="comhead"><a href="user?id=heretohelp">heretohelp</a> 34 minutes ago  | <a href="item?id=3831732">link</a></span></div><br>
<span class="comment"><font color=#000000>I would <i>very</i> much like an answer to these questions.<p>I have been struggling to understand the appeal of all this Haskell-mania (I say this as a long-time Lisp coder) and only come up short for an explanation.</font></span><p><font size=1><u><a href="reply?id=3831732&whence=%69%74%65%6d%3f%69%64%3d%33%38%33%31%36%34%39">reply</a></u></font></td></tr></table></td></tr><tr><td><table border=0><tr><td><img src="http://ycombinator.com/images/s.gif" height=1 width=40></td><td valign=top><center><a id=up_3831751 href="vote?for=3831751&dir=up&whence=%69%74%65%6d%3f%69%64%3d%33%38%33%31%36%34%39"><img src="http://ycombinator.com/images/grayarrow.gif" border=0 vspace=3 hspace=2></a><span id=down_3831751></span></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px; "><span class="comhead"><a href="user?id=jaspervdj">jaspervdj</a> 22 minutes ago  | <a href="item?id=3831751">link</a></span></div><br>
<span class="comment"><font color=#000000>&#62; To me, it looks like you haven't "done" anything at all. You haven't emulated a single instruction. This part of the emulator in C++ would be a couple of structs and helper functions thrown at the top of the file.<p>It seems there's a bit of a misunderstanding. The code in the blogpost consists of incomplete snippets, taken from the actual implementation, found in this repo [1], e.g. the emulator [2]. The reason why I have not included the entire codebase in the blogpost is conciseness; I only wanted to include what's necessary to illustrate the points I wanted to make. I realise this is perhaps a bit unclear and I'll update the post to state this more clearly.<p>&#62; As far as I can see, you've just written a bunch of very complicated code and monads, to get you to place would would have started at in a non-functional language. In that case, what exactly have you gained by using Haskell at all?<p>As much as you would gain by implementing a basic skeleton in any language. In this case, what the blogpost focusses on, is that I have written two backends ways, the ST and the IO one.<p>The advantage of the ST backend is that is guaranteed to be deterministic (which is possible in Haskell): the code cannot perform any side effects visible to the external world.<p>The IO backend does not offer this guarantee, and needs to be able to communicate with the outside world in order to grab keyboard events and display video.<p>The advantage of using the monadic abstraction is that the actual emulator implementation is the same (completely shared code) for both these backends. This allows you to e.g., get deterministic results for tests, while still being able to support all features in the actual emulator binary.<p>The deterministic property is an advantage of using Haskell. I am sure an equivalent of the monadic abstraction could also be implemented using some OOP system.<p>&#62; P.S. Sorry if this comment comes across as insulting / argumentative. I do not have the time to write it in a more pleasing way.<p>No insult taken.<p>[1]: <a href="https://github.com/jaspervdj/dcpu16-hs" rel="nofollow">https://github.com/jaspervdj/dcpu16-hs</a>
[2]: <a href="https://github.com/jaspervdj/dcpu16-hs/blob/master/src/Emulator.hs" rel="nofollow">https://github.com/jaspervdj/dcpu16-hs/blob/master/src/Emula...</a></font></span><p><font size=1><u><a href="reply?id=3831751&whence=%69%74%65%6d%3f%69%64%3d%33%38%33%31%36%34%39">reply</a></u></font></td></tr></table></td></tr></table><br><br>
</td></tr><tr><td><img src="http://ycombinator.com/images/s.gif" height=10 width=0><table width="100%" cellspacing=0 cellpadding=1><tr><td bgcolor=#ff6600></td></tr></table><br>
<center><span class="yclinks"><a href="lists">Lists</a> | <a href="rss">RSS</a> | <a href="http://ycombinator.com/bookmarklet.html">Bookmarklet</a> | <a href="http://ycombinator.com/newsguidelines.html">Guidelines</a> | <a href="http://ycombinator.com/newsfaq.html">FAQ</a> | <a href="http://ycombinator.com/newsnews.html">News News</a> | <a href="item?id=363">Feature Requests</a> | <a href="http://ycombinator.com">Y Combinator</a> | <a href="http://ycombinator.com/apply.html">Apply</a> | <a href="http://ycombinator.com/lib.html">Library</a></span><br><br>
<form method=get action="http://www.hnsearch.com/search#request/all">Search: <input type=text name="q" value="" size=17></form><br>
</center></td></tr></table></center></body></html>